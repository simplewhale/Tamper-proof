//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/alen/Downloads/signMessage-api/target/classes/core/org/spongycastle/crypto/io/CipherOutputStream.java
//

#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/io/FilterOutputStream.h"
#include "java/io/IOException.h"
#include "java/io/OutputStream.h"
#include "java/lang/Exception.h"
#include "org/spongycastle/crypto/BufferedBlockCipher.h"
#include "org/spongycastle/crypto/InvalidCipherTextException.h"
#include "org/spongycastle/crypto/StreamCipher.h"
#include "org/spongycastle/crypto/io/CipherIOException.h"
#include "org/spongycastle/crypto/io/CipherOutputStream.h"
#include "org/spongycastle/crypto/io/InvalidCipherTextIOException.h"
#include "org/spongycastle/crypto/modes/AEADBlockCipher.h"

@interface OrgSpongycastleCryptoIoCipherOutputStream () {
 @public
  OrgSpongycastleCryptoBufferedBlockCipher *bufferedBlockCipher_;
  id<OrgSpongycastleCryptoStreamCipher> streamCipher_;
  id<OrgSpongycastleCryptoModesAEADBlockCipher> aeadBlockCipher_;
  IOSByteArray *oneByte_;
  IOSByteArray *buf_;
}

- (void)ensureCapacityWithInt:(jint)updateSize
                  withBoolean:(jboolean)finalOutput;

@end

J2OBJC_FIELD_SETTER(OrgSpongycastleCryptoIoCipherOutputStream, bufferedBlockCipher_, OrgSpongycastleCryptoBufferedBlockCipher *)
J2OBJC_FIELD_SETTER(OrgSpongycastleCryptoIoCipherOutputStream, streamCipher_, id<OrgSpongycastleCryptoStreamCipher>)
J2OBJC_FIELD_SETTER(OrgSpongycastleCryptoIoCipherOutputStream, aeadBlockCipher_, id<OrgSpongycastleCryptoModesAEADBlockCipher>)
J2OBJC_FIELD_SETTER(OrgSpongycastleCryptoIoCipherOutputStream, oneByte_, IOSByteArray *)
J2OBJC_FIELD_SETTER(OrgSpongycastleCryptoIoCipherOutputStream, buf_, IOSByteArray *)

__attribute__((unused)) static void OrgSpongycastleCryptoIoCipherOutputStream_ensureCapacityWithInt_withBoolean_(OrgSpongycastleCryptoIoCipherOutputStream *self, jint updateSize, jboolean finalOutput);

@implementation OrgSpongycastleCryptoIoCipherOutputStream

- (instancetype)initWithJavaIoOutputStream:(JavaIoOutputStream *)os
withOrgSpongycastleCryptoBufferedBlockCipher:(OrgSpongycastleCryptoBufferedBlockCipher *)cipher {
  OrgSpongycastleCryptoIoCipherOutputStream_initWithJavaIoOutputStream_withOrgSpongycastleCryptoBufferedBlockCipher_(self, os, cipher);
  return self;
}

- (instancetype)initWithJavaIoOutputStream:(JavaIoOutputStream *)os
     withOrgSpongycastleCryptoStreamCipher:(id<OrgSpongycastleCryptoStreamCipher>)cipher {
  OrgSpongycastleCryptoIoCipherOutputStream_initWithJavaIoOutputStream_withOrgSpongycastleCryptoStreamCipher_(self, os, cipher);
  return self;
}

- (instancetype)initWithJavaIoOutputStream:(JavaIoOutputStream *)os
withOrgSpongycastleCryptoModesAEADBlockCipher:(id<OrgSpongycastleCryptoModesAEADBlockCipher>)cipher {
  OrgSpongycastleCryptoIoCipherOutputStream_initWithJavaIoOutputStream_withOrgSpongycastleCryptoModesAEADBlockCipher_(self, os, cipher);
  return self;
}

- (void)writeWithInt:(jint)b {
  *IOSByteArray_GetRef(nil_chk(oneByte_), 0) = (jbyte) b;
  if (streamCipher_ != nil) {
    [((JavaIoOutputStream *) nil_chk(out_)) writeWithInt:[streamCipher_ returnByteWithByte:(jbyte) b]];
  }
  else {
    [self writeWithByteArray:oneByte_ withInt:0 withInt:1];
  }
}

- (void)writeWithByteArray:(IOSByteArray *)b {
  [self writeWithByteArray:b withInt:0 withInt:((IOSByteArray *) nil_chk(b))->size_];
}

- (void)writeWithByteArray:(IOSByteArray *)b
                   withInt:(jint)off
                   withInt:(jint)len {
  OrgSpongycastleCryptoIoCipherOutputStream_ensureCapacityWithInt_withBoolean_(self, len, false);
  if (bufferedBlockCipher_ != nil) {
    jint outLen = [bufferedBlockCipher_ processBytesWithByteArray:b withInt:off withInt:len withByteArray:buf_ withInt:0];
    if (outLen != 0) {
      [((JavaIoOutputStream *) nil_chk(out_)) writeWithByteArray:buf_ withInt:0 withInt:outLen];
    }
  }
  else if (aeadBlockCipher_ != nil) {
    jint outLen = [aeadBlockCipher_ processBytesWithByteArray:b withInt:off withInt:len withByteArray:buf_ withInt:0];
    if (outLen != 0) {
      [((JavaIoOutputStream *) nil_chk(out_)) writeWithByteArray:buf_ withInt:0 withInt:outLen];
    }
  }
  else {
    [((id<OrgSpongycastleCryptoStreamCipher>) nil_chk(streamCipher_)) processBytesWithByteArray:b withInt:off withInt:len withByteArray:buf_ withInt:0];
    [((JavaIoOutputStream *) nil_chk(out_)) writeWithByteArray:buf_ withInt:0 withInt:len];
  }
}

- (void)ensureCapacityWithInt:(jint)updateSize
                  withBoolean:(jboolean)finalOutput {
  OrgSpongycastleCryptoIoCipherOutputStream_ensureCapacityWithInt_withBoolean_(self, updateSize, finalOutput);
}

- (void)flush {
  [((JavaIoOutputStream *) nil_chk(out_)) flush];
}

- (void)close {
  OrgSpongycastleCryptoIoCipherOutputStream_ensureCapacityWithInt_withBoolean_(self, 0, true);
  JavaIoIOException *error = nil;
  @try {
    if (bufferedBlockCipher_ != nil) {
      jint outLen = [bufferedBlockCipher_ doFinalWithByteArray:buf_ withInt:0];
      if (outLen != 0) {
        [((JavaIoOutputStream *) nil_chk(out_)) writeWithByteArray:buf_ withInt:0 withInt:outLen];
      }
    }
    else if (aeadBlockCipher_ != nil) {
      jint outLen = [aeadBlockCipher_ doFinalWithByteArray:buf_ withInt:0];
      if (outLen != 0) {
        [((JavaIoOutputStream *) nil_chk(out_)) writeWithByteArray:buf_ withInt:0 withInt:outLen];
      }
    }
    else if (streamCipher_ != nil) {
      [streamCipher_ reset];
    }
  }
  @catch (OrgSpongycastleCryptoInvalidCipherTextException *e) {
    error = new_OrgSpongycastleCryptoIoInvalidCipherTextIOException_initWithNSString_withJavaLangThrowable_(@"Error finalising cipher data", e);
  }
  @catch (JavaLangException *e) {
    error = new_OrgSpongycastleCryptoIoCipherIOException_initWithNSString_withJavaLangThrowable_(@"Error closing stream: ", e);
  }
  @try {
    [self flush];
    [((JavaIoOutputStream *) nil_chk(out_)) close];
  }
  @catch (JavaIoIOException *e) {
    if (error == nil) {
      error = e;
    }
  }
  if (error != nil) {
    @throw error;
  }
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, -1, -1, -1 },
    { NULL, NULL, 0x1, -1, 1, -1, -1, -1, -1 },
    { NULL, NULL, 0x1, -1, 2, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 3, 4, 5, -1, -1, -1 },
    { NULL, "V", 0x1, 3, 6, 5, -1, -1, -1 },
    { NULL, "V", 0x1, 3, 7, 5, -1, -1, -1 },
    { NULL, "V", 0x2, 8, 9, -1, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, 5, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, 5, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initWithJavaIoOutputStream:withOrgSpongycastleCryptoBufferedBlockCipher:);
  methods[1].selector = @selector(initWithJavaIoOutputStream:withOrgSpongycastleCryptoStreamCipher:);
  methods[2].selector = @selector(initWithJavaIoOutputStream:withOrgSpongycastleCryptoModesAEADBlockCipher:);
  methods[3].selector = @selector(writeWithInt:);
  methods[4].selector = @selector(writeWithByteArray:);
  methods[5].selector = @selector(writeWithByteArray:withInt:withInt:);
  methods[6].selector = @selector(ensureCapacityWithInt:withBoolean:);
  methods[7].selector = @selector(flush);
  methods[8].selector = @selector(close);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "bufferedBlockCipher_", "LOrgSpongycastleCryptoBufferedBlockCipher;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "streamCipher_", "LOrgSpongycastleCryptoStreamCipher;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "aeadBlockCipher_", "LOrgSpongycastleCryptoModesAEADBlockCipher;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "oneByte_", "[B", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "buf_", "[B", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LJavaIoOutputStream;LOrgSpongycastleCryptoBufferedBlockCipher;", "LJavaIoOutputStream;LOrgSpongycastleCryptoStreamCipher;", "LJavaIoOutputStream;LOrgSpongycastleCryptoModesAEADBlockCipher;", "write", "I", "LJavaIoIOException;", "[B", "[BII", "ensureCapacity", "IZ" };
  static const J2ObjcClassInfo _OrgSpongycastleCryptoIoCipherOutputStream = { "CipherOutputStream", "org.spongycastle.crypto.io", ptrTable, methods, fields, 7, 0x1, 9, 5, -1, -1, -1, -1, -1 };
  return &_OrgSpongycastleCryptoIoCipherOutputStream;
}

@end

void OrgSpongycastleCryptoIoCipherOutputStream_initWithJavaIoOutputStream_withOrgSpongycastleCryptoBufferedBlockCipher_(OrgSpongycastleCryptoIoCipherOutputStream *self, JavaIoOutputStream *os, OrgSpongycastleCryptoBufferedBlockCipher *cipher) {
  JavaIoFilterOutputStream_initWithJavaIoOutputStream_(self, os);
  self->oneByte_ = [IOSByteArray newArrayWithLength:1];
  self->bufferedBlockCipher_ = cipher;
}

OrgSpongycastleCryptoIoCipherOutputStream *new_OrgSpongycastleCryptoIoCipherOutputStream_initWithJavaIoOutputStream_withOrgSpongycastleCryptoBufferedBlockCipher_(JavaIoOutputStream *os, OrgSpongycastleCryptoBufferedBlockCipher *cipher) {
  J2OBJC_NEW_IMPL(OrgSpongycastleCryptoIoCipherOutputStream, initWithJavaIoOutputStream_withOrgSpongycastleCryptoBufferedBlockCipher_, os, cipher)
}

OrgSpongycastleCryptoIoCipherOutputStream *create_OrgSpongycastleCryptoIoCipherOutputStream_initWithJavaIoOutputStream_withOrgSpongycastleCryptoBufferedBlockCipher_(JavaIoOutputStream *os, OrgSpongycastleCryptoBufferedBlockCipher *cipher) {
  J2OBJC_CREATE_IMPL(OrgSpongycastleCryptoIoCipherOutputStream, initWithJavaIoOutputStream_withOrgSpongycastleCryptoBufferedBlockCipher_, os, cipher)
}

void OrgSpongycastleCryptoIoCipherOutputStream_initWithJavaIoOutputStream_withOrgSpongycastleCryptoStreamCipher_(OrgSpongycastleCryptoIoCipherOutputStream *self, JavaIoOutputStream *os, id<OrgSpongycastleCryptoStreamCipher> cipher) {
  JavaIoFilterOutputStream_initWithJavaIoOutputStream_(self, os);
  self->oneByte_ = [IOSByteArray newArrayWithLength:1];
  self->streamCipher_ = cipher;
}

OrgSpongycastleCryptoIoCipherOutputStream *new_OrgSpongycastleCryptoIoCipherOutputStream_initWithJavaIoOutputStream_withOrgSpongycastleCryptoStreamCipher_(JavaIoOutputStream *os, id<OrgSpongycastleCryptoStreamCipher> cipher) {
  J2OBJC_NEW_IMPL(OrgSpongycastleCryptoIoCipherOutputStream, initWithJavaIoOutputStream_withOrgSpongycastleCryptoStreamCipher_, os, cipher)
}

OrgSpongycastleCryptoIoCipherOutputStream *create_OrgSpongycastleCryptoIoCipherOutputStream_initWithJavaIoOutputStream_withOrgSpongycastleCryptoStreamCipher_(JavaIoOutputStream *os, id<OrgSpongycastleCryptoStreamCipher> cipher) {
  J2OBJC_CREATE_IMPL(OrgSpongycastleCryptoIoCipherOutputStream, initWithJavaIoOutputStream_withOrgSpongycastleCryptoStreamCipher_, os, cipher)
}

void OrgSpongycastleCryptoIoCipherOutputStream_initWithJavaIoOutputStream_withOrgSpongycastleCryptoModesAEADBlockCipher_(OrgSpongycastleCryptoIoCipherOutputStream *self, JavaIoOutputStream *os, id<OrgSpongycastleCryptoModesAEADBlockCipher> cipher) {
  JavaIoFilterOutputStream_initWithJavaIoOutputStream_(self, os);
  self->oneByte_ = [IOSByteArray newArrayWithLength:1];
  self->aeadBlockCipher_ = cipher;
}

OrgSpongycastleCryptoIoCipherOutputStream *new_OrgSpongycastleCryptoIoCipherOutputStream_initWithJavaIoOutputStream_withOrgSpongycastleCryptoModesAEADBlockCipher_(JavaIoOutputStream *os, id<OrgSpongycastleCryptoModesAEADBlockCipher> cipher) {
  J2OBJC_NEW_IMPL(OrgSpongycastleCryptoIoCipherOutputStream, initWithJavaIoOutputStream_withOrgSpongycastleCryptoModesAEADBlockCipher_, os, cipher)
}

OrgSpongycastleCryptoIoCipherOutputStream *create_OrgSpongycastleCryptoIoCipherOutputStream_initWithJavaIoOutputStream_withOrgSpongycastleCryptoModesAEADBlockCipher_(JavaIoOutputStream *os, id<OrgSpongycastleCryptoModesAEADBlockCipher> cipher) {
  J2OBJC_CREATE_IMPL(OrgSpongycastleCryptoIoCipherOutputStream, initWithJavaIoOutputStream_withOrgSpongycastleCryptoModesAEADBlockCipher_, os, cipher)
}

void OrgSpongycastleCryptoIoCipherOutputStream_ensureCapacityWithInt_withBoolean_(OrgSpongycastleCryptoIoCipherOutputStream *self, jint updateSize, jboolean finalOutput) {
  jint bufLen = updateSize;
  if (finalOutput) {
    if (self->bufferedBlockCipher_ != nil) {
      bufLen = [self->bufferedBlockCipher_ getOutputSizeWithInt:updateSize];
    }
    else if (self->aeadBlockCipher_ != nil) {
      bufLen = [self->aeadBlockCipher_ getOutputSizeWithInt:updateSize];
    }
  }
  else {
    if (self->bufferedBlockCipher_ != nil) {
      bufLen = [self->bufferedBlockCipher_ getUpdateOutputSizeWithInt:updateSize];
    }
    else if (self->aeadBlockCipher_ != nil) {
      bufLen = [self->aeadBlockCipher_ getUpdateOutputSizeWithInt:updateSize];
    }
  }
  if ((self->buf_ == nil) || (((IOSByteArray *) nil_chk(self->buf_))->size_ < bufLen)) {
    self->buf_ = [IOSByteArray newArrayWithLength:bufLen];
  }
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgSpongycastleCryptoIoCipherOutputStream)
