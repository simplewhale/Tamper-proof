//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/alen/Downloads/signMessage-api/target/classes/core/org/spongycastle/crypto/prng/ThreadedSeedGenerator.java
//

#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/lang/InterruptedException.h"
#include "java/lang/Runnable.h"
#include "java/lang/Thread.h"
#include "org/spongycastle/crypto/prng/ThreadedSeedGenerator.h"

@interface OrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator : NSObject < JavaLangRunnable > {
 @public
  volatile_jint counter_;
  volatile_jboolean stop_;
}

- (instancetype)initWithOrgSpongycastleCryptoPrngThreadedSeedGenerator:(OrgSpongycastleCryptoPrngThreadedSeedGenerator *)outer$;

- (void)run;

- (IOSByteArray *)generateSeedWithInt:(jint)numbytes
                          withBoolean:(jboolean)fast;

@end

J2OBJC_EMPTY_STATIC_INIT(OrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator)

__attribute__((unused)) static void OrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator_initWithOrgSpongycastleCryptoPrngThreadedSeedGenerator_(OrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator *self, OrgSpongycastleCryptoPrngThreadedSeedGenerator *outer$);

__attribute__((unused)) static OrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator *new_OrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator_initWithOrgSpongycastleCryptoPrngThreadedSeedGenerator_(OrgSpongycastleCryptoPrngThreadedSeedGenerator *outer$) NS_RETURNS_RETAINED;

__attribute__((unused)) static OrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator *create_OrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator_initWithOrgSpongycastleCryptoPrngThreadedSeedGenerator_(OrgSpongycastleCryptoPrngThreadedSeedGenerator *outer$);

J2OBJC_TYPE_LITERAL_HEADER(OrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator)

@implementation OrgSpongycastleCryptoPrngThreadedSeedGenerator

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  OrgSpongycastleCryptoPrngThreadedSeedGenerator_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

- (IOSByteArray *)generateSeedWithInt:(jint)numBytes
                          withBoolean:(jboolean)fast {
  OrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator *gen = new_OrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator_initWithOrgSpongycastleCryptoPrngThreadedSeedGenerator_(self);
  return [gen generateSeedWithInt:numBytes withBoolean:fast];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "[B", 0x1, 0, 1, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(init);
  methods[1].selector = @selector(generateSeedWithInt:withBoolean:);
  #pragma clang diagnostic pop
  static const void *ptrTable[] = { "generateSeed", "IZ", "LOrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator;" };
  static const J2ObjcClassInfo _OrgSpongycastleCryptoPrngThreadedSeedGenerator = { "ThreadedSeedGenerator", "org.spongycastle.crypto.prng", ptrTable, methods, NULL, 7, 0x1, 2, 0, -1, 2, -1, -1, -1 };
  return &_OrgSpongycastleCryptoPrngThreadedSeedGenerator;
}

@end

void OrgSpongycastleCryptoPrngThreadedSeedGenerator_init(OrgSpongycastleCryptoPrngThreadedSeedGenerator *self) {
  NSObject_init(self);
}

OrgSpongycastleCryptoPrngThreadedSeedGenerator *new_OrgSpongycastleCryptoPrngThreadedSeedGenerator_init() {
  J2OBJC_NEW_IMPL(OrgSpongycastleCryptoPrngThreadedSeedGenerator, init)
}

OrgSpongycastleCryptoPrngThreadedSeedGenerator *create_OrgSpongycastleCryptoPrngThreadedSeedGenerator_init() {
  J2OBJC_CREATE_IMPL(OrgSpongycastleCryptoPrngThreadedSeedGenerator, init)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgSpongycastleCryptoPrngThreadedSeedGenerator)

@implementation OrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator

- (instancetype)initWithOrgSpongycastleCryptoPrngThreadedSeedGenerator:(OrgSpongycastleCryptoPrngThreadedSeedGenerator *)outer$ {
  OrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator_initWithOrgSpongycastleCryptoPrngThreadedSeedGenerator_(self, outer$);
  return self;
}

- (void)run {
  while (!JreLoadVolatileBoolean(&self->stop_)) {
    self->counter_++;
  }
}

- (IOSByteArray *)generateSeedWithInt:(jint)numbytes
                          withBoolean:(jboolean)fast {
  JavaLangThread *t = new_JavaLangThread_initWithJavaLangRunnable_(self);
  IOSByteArray *result = [IOSByteArray newArrayWithLength:numbytes];
  JreAssignVolatileInt(&self->counter_, 0);
  JreAssignVolatileBoolean(&self->stop_, false);
  jint last = 0;
  jint end;
  [t start];
  if (fast) {
    end = numbytes;
  }
  else {
    end = numbytes * 8;
  }
  for (jint i = 0; i < end; i++) {
    while (JreLoadVolatileInt(&self->counter_) == last) {
      @try {
        JavaLangThread_sleepWithLong_(1);
      }
      @catch (JavaLangInterruptedException *e) {
      }
    }
    last = JreLoadVolatileInt(&self->counter_);
    if (fast) {
      *IOSByteArray_GetRef(result, i) = (jbyte) (last & (jint) 0xff);
    }
    else {
      jint bytepos = i / 8;
      *IOSByteArray_GetRef(result, bytepos) = (jbyte) ((JreLShift32(IOSByteArray_Get(result, bytepos), 1)) | (last & 1));
    }
  }
  JreAssignVolatileBoolean(&stop_, true);
  return result;
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x2, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "[B", 0x1, 0, 1, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initWithOrgSpongycastleCryptoPrngThreadedSeedGenerator:);
  methods[1].selector = @selector(run);
  methods[2].selector = @selector(generateSeedWithInt:withBoolean:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "counter_", "I", .constantValue.asLong = 0, 0x42, -1, -1, -1, -1 },
    { "stop_", "Z", .constantValue.asLong = 0, 0x42, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "generateSeed", "IZ", "LOrgSpongycastleCryptoPrngThreadedSeedGenerator;" };
  static const J2ObjcClassInfo _OrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator = { "SeedGenerator", "org.spongycastle.crypto.prng", ptrTable, methods, fields, 7, 0x2, 3, 2, 2, -1, -1, -1, -1 };
  return &_OrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator;
}

@end

void OrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator_initWithOrgSpongycastleCryptoPrngThreadedSeedGenerator_(OrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator *self, OrgSpongycastleCryptoPrngThreadedSeedGenerator *outer$) {
  NSObject_init(self);
  JreAssignVolatileInt(&self->counter_, 0);
  JreAssignVolatileBoolean(&self->stop_, false);
}

OrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator *new_OrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator_initWithOrgSpongycastleCryptoPrngThreadedSeedGenerator_(OrgSpongycastleCryptoPrngThreadedSeedGenerator *outer$) {
  J2OBJC_NEW_IMPL(OrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator, initWithOrgSpongycastleCryptoPrngThreadedSeedGenerator_, outer$)
}

OrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator *create_OrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator_initWithOrgSpongycastleCryptoPrngThreadedSeedGenerator_(OrgSpongycastleCryptoPrngThreadedSeedGenerator *outer$) {
  J2OBJC_CREATE_IMPL(OrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator, initWithOrgSpongycastleCryptoPrngThreadedSeedGenerator_, outer$)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgSpongycastleCryptoPrngThreadedSeedGenerator_SeedGenerator)
