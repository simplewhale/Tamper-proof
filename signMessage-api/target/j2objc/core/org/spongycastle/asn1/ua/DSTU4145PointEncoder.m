//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/alen/Downloads/signMessage-api/target/classes/core/org/spongycastle/asn1/ua/DSTU4145PointEncoder.java
//

#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/math/BigInteger.h"
#include "java/util/Random.h"
#include "org/spongycastle/asn1/ua/DSTU4145PointEncoder.h"
#include "org/spongycastle/math/ec/ECConstants.h"
#include "org/spongycastle/math/ec/ECCurve.h"
#include "org/spongycastle/math/ec/ECFieldElement.h"
#include "org/spongycastle/math/ec/ECPoint.h"

@interface OrgSpongycastleAsn1UaDSTU4145PointEncoder ()

+ (OrgSpongycastleMathEcECFieldElement *)traceWithOrgSpongycastleMathEcECFieldElement:(OrgSpongycastleMathEcECFieldElement *)fe;

+ (OrgSpongycastleMathEcECFieldElement *)solveQuadraticEquationWithOrgSpongycastleMathEcECCurve:(OrgSpongycastleMathEcECCurve *)curve
                                                        withOrgSpongycastleMathEcECFieldElement:(OrgSpongycastleMathEcECFieldElement *)beta;

@end

__attribute__((unused)) static OrgSpongycastleMathEcECFieldElement *OrgSpongycastleAsn1UaDSTU4145PointEncoder_traceWithOrgSpongycastleMathEcECFieldElement_(OrgSpongycastleMathEcECFieldElement *fe);

__attribute__((unused)) static OrgSpongycastleMathEcECFieldElement *OrgSpongycastleAsn1UaDSTU4145PointEncoder_solveQuadraticEquationWithOrgSpongycastleMathEcECCurve_withOrgSpongycastleMathEcECFieldElement_(OrgSpongycastleMathEcECCurve *curve, OrgSpongycastleMathEcECFieldElement *beta);

@implementation OrgSpongycastleAsn1UaDSTU4145PointEncoder

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  OrgSpongycastleAsn1UaDSTU4145PointEncoder_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

+ (OrgSpongycastleMathEcECFieldElement *)traceWithOrgSpongycastleMathEcECFieldElement:(OrgSpongycastleMathEcECFieldElement *)fe {
  return OrgSpongycastleAsn1UaDSTU4145PointEncoder_traceWithOrgSpongycastleMathEcECFieldElement_(fe);
}

+ (OrgSpongycastleMathEcECFieldElement *)solveQuadraticEquationWithOrgSpongycastleMathEcECCurve:(OrgSpongycastleMathEcECCurve *)curve
                                                        withOrgSpongycastleMathEcECFieldElement:(OrgSpongycastleMathEcECFieldElement *)beta {
  return OrgSpongycastleAsn1UaDSTU4145PointEncoder_solveQuadraticEquationWithOrgSpongycastleMathEcECCurve_withOrgSpongycastleMathEcECFieldElement_(curve, beta);
}

+ (IOSByteArray *)encodePointWithOrgSpongycastleMathEcECPoint:(OrgSpongycastleMathEcECPoint *)Q {
  return OrgSpongycastleAsn1UaDSTU4145PointEncoder_encodePointWithOrgSpongycastleMathEcECPoint_(Q);
}

+ (OrgSpongycastleMathEcECPoint *)decodePointWithOrgSpongycastleMathEcECCurve:(OrgSpongycastleMathEcECCurve *)curve
                                                                withByteArray:(IOSByteArray *)bytes {
  return OrgSpongycastleAsn1UaDSTU4145PointEncoder_decodePointWithOrgSpongycastleMathEcECCurve_withByteArray_(curve, bytes);
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "LOrgSpongycastleMathEcECFieldElement;", 0xa, 0, 1, -1, -1, -1, -1 },
    { NULL, "LOrgSpongycastleMathEcECFieldElement;", 0xa, 2, 3, -1, -1, -1, -1 },
    { NULL, "[B", 0x9, 4, 5, -1, -1, -1, -1 },
    { NULL, "LOrgSpongycastleMathEcECPoint;", 0x9, 6, 7, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(init);
  methods[1].selector = @selector(traceWithOrgSpongycastleMathEcECFieldElement:);
  methods[2].selector = @selector(solveQuadraticEquationWithOrgSpongycastleMathEcECCurve:withOrgSpongycastleMathEcECFieldElement:);
  methods[3].selector = @selector(encodePointWithOrgSpongycastleMathEcECPoint:);
  methods[4].selector = @selector(decodePointWithOrgSpongycastleMathEcECCurve:withByteArray:);
  #pragma clang diagnostic pop
  static const void *ptrTable[] = { "trace", "LOrgSpongycastleMathEcECFieldElement;", "solveQuadraticEquation", "LOrgSpongycastleMathEcECCurve;LOrgSpongycastleMathEcECFieldElement;", "encodePoint", "LOrgSpongycastleMathEcECPoint;", "decodePoint", "LOrgSpongycastleMathEcECCurve;[B" };
  static const J2ObjcClassInfo _OrgSpongycastleAsn1UaDSTU4145PointEncoder = { "DSTU4145PointEncoder", "org.spongycastle.asn1.ua", ptrTable, methods, NULL, 7, 0x401, 5, 0, -1, -1, -1, -1, -1 };
  return &_OrgSpongycastleAsn1UaDSTU4145PointEncoder;
}

@end

void OrgSpongycastleAsn1UaDSTU4145PointEncoder_init(OrgSpongycastleAsn1UaDSTU4145PointEncoder *self) {
  NSObject_init(self);
}

OrgSpongycastleMathEcECFieldElement *OrgSpongycastleAsn1UaDSTU4145PointEncoder_traceWithOrgSpongycastleMathEcECFieldElement_(OrgSpongycastleMathEcECFieldElement *fe) {
  OrgSpongycastleAsn1UaDSTU4145PointEncoder_initialize();
  OrgSpongycastleMathEcECFieldElement *t = fe;
  for (jint i = 1; i < [((OrgSpongycastleMathEcECFieldElement *) nil_chk(fe)) getFieldSize]; ++i) {
    t = [((OrgSpongycastleMathEcECFieldElement *) nil_chk([((OrgSpongycastleMathEcECFieldElement *) nil_chk(t)) square])) addWithOrgSpongycastleMathEcECFieldElement:fe];
  }
  return t;
}

OrgSpongycastleMathEcECFieldElement *OrgSpongycastleAsn1UaDSTU4145PointEncoder_solveQuadraticEquationWithOrgSpongycastleMathEcECCurve_withOrgSpongycastleMathEcECFieldElement_(OrgSpongycastleMathEcECCurve *curve, OrgSpongycastleMathEcECFieldElement *beta) {
  OrgSpongycastleAsn1UaDSTU4145PointEncoder_initialize();
  if ([((OrgSpongycastleMathEcECFieldElement *) nil_chk(beta)) isZero]) {
    return beta;
  }
  OrgSpongycastleMathEcECFieldElement *zeroElement = [((OrgSpongycastleMathEcECCurve *) nil_chk(curve)) fromBigIntegerWithJavaMathBigInteger:JreLoadStatic(OrgSpongycastleMathEcECConstants, ZERO)];
  OrgSpongycastleMathEcECFieldElement *z = nil;
  OrgSpongycastleMathEcECFieldElement *gamma = nil;
  JavaUtilRandom *rand = new_JavaUtilRandom_init();
  jint m = [beta getFieldSize];
  do {
    OrgSpongycastleMathEcECFieldElement *t = [curve fromBigIntegerWithJavaMathBigInteger:new_JavaMathBigInteger_initWithInt_withJavaUtilRandom_(m, rand)];
    z = zeroElement;
    OrgSpongycastleMathEcECFieldElement *w = beta;
    for (jint i = 1; i <= m - 1; i++) {
      OrgSpongycastleMathEcECFieldElement *w2 = [((OrgSpongycastleMathEcECFieldElement *) nil_chk(w)) square];
      z = [((OrgSpongycastleMathEcECFieldElement *) nil_chk([((OrgSpongycastleMathEcECFieldElement *) nil_chk(z)) square])) addWithOrgSpongycastleMathEcECFieldElement:[((OrgSpongycastleMathEcECFieldElement *) nil_chk(w2)) multiplyWithOrgSpongycastleMathEcECFieldElement:t]];
      w = [w2 addWithOrgSpongycastleMathEcECFieldElement:beta];
    }
    if (![((OrgSpongycastleMathEcECFieldElement *) nil_chk(w)) isZero]) {
      return nil;
    }
    gamma = [((OrgSpongycastleMathEcECFieldElement *) nil_chk([((OrgSpongycastleMathEcECFieldElement *) nil_chk(z)) square])) addWithOrgSpongycastleMathEcECFieldElement:z];
  }
  while ([((OrgSpongycastleMathEcECFieldElement *) nil_chk(gamma)) isZero]);
  return z;
}

IOSByteArray *OrgSpongycastleAsn1UaDSTU4145PointEncoder_encodePointWithOrgSpongycastleMathEcECPoint_(OrgSpongycastleMathEcECPoint *Q) {
  OrgSpongycastleAsn1UaDSTU4145PointEncoder_initialize();
  Q = [((OrgSpongycastleMathEcECPoint *) nil_chk(Q)) normalize];
  OrgSpongycastleMathEcECFieldElement *x = [((OrgSpongycastleMathEcECPoint *) nil_chk(Q)) getAffineXCoord];
  IOSByteArray *bytes = [((OrgSpongycastleMathEcECFieldElement *) nil_chk(x)) getEncoded];
  if (![x isZero]) {
    OrgSpongycastleMathEcECFieldElement *z = [((OrgSpongycastleMathEcECFieldElement *) nil_chk([Q getAffineYCoord])) divideWithOrgSpongycastleMathEcECFieldElement:x];
    if ([((OrgSpongycastleMathEcECFieldElement *) nil_chk(OrgSpongycastleAsn1UaDSTU4145PointEncoder_traceWithOrgSpongycastleMathEcECFieldElement_(z))) isOne]) {
      *IOSByteArray_GetRef(bytes, ((IOSByteArray *) nil_chk(bytes))->size_ - 1) |= (jint) 0x01;
    }
    else {
      *IOSByteArray_GetRef(bytes, ((IOSByteArray *) nil_chk(bytes))->size_ - 1) &= (jint) 0xFE;
    }
  }
  return bytes;
}

OrgSpongycastleMathEcECPoint *OrgSpongycastleAsn1UaDSTU4145PointEncoder_decodePointWithOrgSpongycastleMathEcECCurve_withByteArray_(OrgSpongycastleMathEcECCurve *curve, IOSByteArray *bytes) {
  OrgSpongycastleAsn1UaDSTU4145PointEncoder_initialize();
  OrgSpongycastleMathEcECFieldElement *k = [((OrgSpongycastleMathEcECCurve *) nil_chk(curve)) fromBigIntegerWithJavaMathBigInteger:JavaMathBigInteger_valueOfWithLong_(IOSByteArray_Get(bytes, ((IOSByteArray *) nil_chk(bytes))->size_ - 1) & (jint) 0x1)];
  OrgSpongycastleMathEcECFieldElement *xp = [curve fromBigIntegerWithJavaMathBigInteger:new_JavaMathBigInteger_initWithInt_withByteArray_(1, bytes)];
  if (![((OrgSpongycastleMathEcECFieldElement *) nil_chk(OrgSpongycastleAsn1UaDSTU4145PointEncoder_traceWithOrgSpongycastleMathEcECFieldElement_(xp))) isEqual:[curve getA]]) {
    xp = [((OrgSpongycastleMathEcECFieldElement *) nil_chk(xp)) addOne];
  }
  OrgSpongycastleMathEcECFieldElement *yp = nil;
  if ([((OrgSpongycastleMathEcECFieldElement *) nil_chk(xp)) isZero]) {
    yp = [((OrgSpongycastleMathEcECFieldElement *) nil_chk([curve getB])) sqrt];
  }
  else {
    OrgSpongycastleMathEcECFieldElement *beta = [((OrgSpongycastleMathEcECFieldElement *) nil_chk([((OrgSpongycastleMathEcECFieldElement *) nil_chk([((OrgSpongycastleMathEcECFieldElement *) nil_chk([((OrgSpongycastleMathEcECFieldElement *) nil_chk([xp square])) invert])) multiplyWithOrgSpongycastleMathEcECFieldElement:[curve getB]])) addWithOrgSpongycastleMathEcECFieldElement:[curve getA]])) addWithOrgSpongycastleMathEcECFieldElement:xp];
    OrgSpongycastleMathEcECFieldElement *z = OrgSpongycastleAsn1UaDSTU4145PointEncoder_solveQuadraticEquationWithOrgSpongycastleMathEcECCurve_withOrgSpongycastleMathEcECFieldElement_(curve, beta);
    if (z != nil) {
      if (![((OrgSpongycastleMathEcECFieldElement *) nil_chk(OrgSpongycastleAsn1UaDSTU4145PointEncoder_traceWithOrgSpongycastleMathEcECFieldElement_(z))) isEqual:k]) {
        z = [z addOne];
      }
      yp = [xp multiplyWithOrgSpongycastleMathEcECFieldElement:z];
    }
  }
  if (yp == nil) {
    @throw new_JavaLangIllegalArgumentException_initWithNSString_(@"Invalid point compression");
  }
  return [curve validatePointWithJavaMathBigInteger:[xp toBigInteger] withJavaMathBigInteger:[yp toBigInteger]];
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgSpongycastleAsn1UaDSTU4145PointEncoder)
