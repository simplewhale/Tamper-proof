//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/alen/Downloads/signMessage-api/target/classes/core/org/spongycastle/pqc/crypto/newhope/ErrorCorrection.java
//

#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "org/spongycastle/pqc/crypto/newhope/ChaCha20.h"
#include "org/spongycastle/pqc/crypto/newhope/ErrorCorrection.h"
#include "org/spongycastle/pqc/crypto/newhope/Params.h"
#include "org/spongycastle/util/Arrays.h"

@implementation OrgSpongycastlePqcCryptoNewhopeErrorCorrection

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  OrgSpongycastlePqcCryptoNewhopeErrorCorrection_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

+ (jint)absWithInt:(jint)v {
  return OrgSpongycastlePqcCryptoNewhopeErrorCorrection_absWithInt_(v);
}

+ (jint)fWithIntArray:(IOSIntArray *)v
              withInt:(jint)off0
              withInt:(jint)off1
              withInt:(jint)x {
  return OrgSpongycastlePqcCryptoNewhopeErrorCorrection_fWithIntArray_withInt_withInt_withInt_(v, off0, off1, x);
}

+ (jint)gWithInt:(jint)x {
  return OrgSpongycastlePqcCryptoNewhopeErrorCorrection_gWithInt_(x);
}

+ (void)helpRecWithShortArray:(IOSShortArray *)c
               withShortArray:(IOSShortArray *)v
                withByteArray:(IOSByteArray *)seed
                     withByte:(jbyte)nonce {
  OrgSpongycastlePqcCryptoNewhopeErrorCorrection_helpRecWithShortArray_withShortArray_withByteArray_withByte_(c, v, seed, nonce);
}

+ (jshort)LDDecodeWithInt:(jint)xi0
                  withInt:(jint)xi1
                  withInt:(jint)xi2
                  withInt:(jint)xi3 {
  return OrgSpongycastlePqcCryptoNewhopeErrorCorrection_LDDecodeWithInt_withInt_withInt_withInt_(xi0, xi1, xi2, xi3);
}

+ (void)recWithByteArray:(IOSByteArray *)key
          withShortArray:(IOSShortArray *)v
          withShortArray:(IOSShortArray *)c {
  OrgSpongycastlePqcCryptoNewhopeErrorCorrection_recWithByteArray_withShortArray_withShortArray_(key, v, c);
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x0, -1, -1, -1, -1, -1, -1 },
    { NULL, "I", 0x8, 0, 1, -1, -1, -1, -1 },
    { NULL, "I", 0x8, 2, 3, -1, -1, -1, -1 },
    { NULL, "I", 0x8, 4, 1, -1, -1, -1, -1 },
    { NULL, "V", 0x8, 5, 6, -1, -1, -1, -1 },
    { NULL, "S", 0x8, 7, 8, -1, -1, -1, -1 },
    { NULL, "V", 0x8, 9, 10, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(init);
  methods[1].selector = @selector(absWithInt:);
  methods[2].selector = @selector(fWithIntArray:withInt:withInt:withInt:);
  methods[3].selector = @selector(gWithInt:);
  methods[4].selector = @selector(helpRecWithShortArray:withShortArray:withByteArray:withByte:);
  methods[5].selector = @selector(LDDecodeWithInt:withInt:withInt:withInt:);
  methods[6].selector = @selector(recWithByteArray:withShortArray:withShortArray:);
  #pragma clang diagnostic pop
  static const void *ptrTable[] = { "abs", "I", "f", "[IIII", "g", "helpRec", "[S[S[BB", "LDDecode", "IIII", "rec", "[B[S[S" };
  static const J2ObjcClassInfo _OrgSpongycastlePqcCryptoNewhopeErrorCorrection = { "ErrorCorrection", "org.spongycastle.pqc.crypto.newhope", ptrTable, methods, NULL, 7, 0x0, 7, 0, -1, -1, -1, -1, -1 };
  return &_OrgSpongycastlePqcCryptoNewhopeErrorCorrection;
}

@end

void OrgSpongycastlePqcCryptoNewhopeErrorCorrection_init(OrgSpongycastlePqcCryptoNewhopeErrorCorrection *self) {
  NSObject_init(self);
}

OrgSpongycastlePqcCryptoNewhopeErrorCorrection *new_OrgSpongycastlePqcCryptoNewhopeErrorCorrection_init() {
  J2OBJC_NEW_IMPL(OrgSpongycastlePqcCryptoNewhopeErrorCorrection, init)
}

OrgSpongycastlePqcCryptoNewhopeErrorCorrection *create_OrgSpongycastlePqcCryptoNewhopeErrorCorrection_init() {
  J2OBJC_CREATE_IMPL(OrgSpongycastlePqcCryptoNewhopeErrorCorrection, init)
}

jint OrgSpongycastlePqcCryptoNewhopeErrorCorrection_absWithInt_(jint v) {
  OrgSpongycastlePqcCryptoNewhopeErrorCorrection_initialize();
  jint mask = JreRShift32(v, 31);
  return (v ^ mask) - mask;
}

jint OrgSpongycastlePqcCryptoNewhopeErrorCorrection_fWithIntArray_withInt_withInt_withInt_(IOSIntArray *v, jint off0, jint off1, jint x) {
  OrgSpongycastlePqcCryptoNewhopeErrorCorrection_initialize();
  jint xit;
  jint t;
  jint r;
  jint b;
  b = x * 2730;
  t = JreRShift32(b, 25);
  b = x - t * OrgSpongycastlePqcCryptoNewhopeParams_Q;
  b = 12288 - b;
  JreRShiftAssignInt(&b, 31);
  t -= b;
  r = t & 1;
  xit = JreRShift32(t, 1);
  *IOSIntArray_GetRef(nil_chk(v), off0) = xit + r;
  t -= 1;
  r = t & 1;
  *IOSIntArray_GetRef(v, off1) = (JreRShift32(t, 1)) + r;
  return OrgSpongycastlePqcCryptoNewhopeErrorCorrection_absWithInt_(x - ((IOSIntArray_Get(v, off0)) * 2 * OrgSpongycastlePqcCryptoNewhopeParams_Q));
}

jint OrgSpongycastlePqcCryptoNewhopeErrorCorrection_gWithInt_(jint x) {
  OrgSpongycastlePqcCryptoNewhopeErrorCorrection_initialize();
  jint t;
  jint c;
  jint b;
  b = x * 2730;
  t = JreRShift32(b, 27);
  b = x - t * 49156;
  b = 49155 - b;
  JreRShiftAssignInt(&b, 31);
  t -= b;
  c = t & 1;
  t = (JreRShift32(t, 1)) + c;
  t *= 8 * OrgSpongycastlePqcCryptoNewhopeParams_Q;
  return OrgSpongycastlePqcCryptoNewhopeErrorCorrection_absWithInt_(t - x);
}

void OrgSpongycastlePqcCryptoNewhopeErrorCorrection_helpRecWithShortArray_withShortArray_withByteArray_withByte_(IOSShortArray *c, IOSShortArray *v, IOSByteArray *seed, jbyte nonce) {
  OrgSpongycastlePqcCryptoNewhopeErrorCorrection_initialize();
  IOSByteArray *iv = [IOSByteArray newArrayWithLength:8];
  *IOSByteArray_GetRef(iv, 0) = nonce;
  IOSByteArray *rand = [IOSByteArray newArrayWithLength:32];
  OrgSpongycastlePqcCryptoNewhopeChaCha20_processWithByteArray_withByteArray_withByteArray_withInt_withInt_(seed, iv, rand, 0, rand->size_);
  IOSIntArray *vs = [IOSIntArray newArrayWithLength:8];
  IOSIntArray *vTmp = [IOSIntArray newArrayWithLength:4];
  jint k;
  for (jint i = 0; i < 256; ++i) {
    jint rBit = (JreURShift32(IOSByteArray_Get(rand, JreURShift32(i, 3)), (i & 7))) & 1;
    k = OrgSpongycastlePqcCryptoNewhopeErrorCorrection_fWithIntArray_withInt_withInt_withInt_(vs, 0, 4, 8 * IOSShortArray_Get(nil_chk(v), 0 + i) + 4 * rBit);
    k += OrgSpongycastlePqcCryptoNewhopeErrorCorrection_fWithIntArray_withInt_withInt_withInt_(vs, 1, 5, 8 * IOSShortArray_Get(v, 256 + i) + 4 * rBit);
    k += OrgSpongycastlePqcCryptoNewhopeErrorCorrection_fWithIntArray_withInt_withInt_withInt_(vs, 2, 6, 8 * IOSShortArray_Get(v, 512 + i) + 4 * rBit);
    k += OrgSpongycastlePqcCryptoNewhopeErrorCorrection_fWithIntArray_withInt_withInt_withInt_(vs, 3, 7, 8 * IOSShortArray_Get(v, 768 + i) + 4 * rBit);
    k = JreRShift32((2 * OrgSpongycastlePqcCryptoNewhopeParams_Q - 1 - k), 31);
    *IOSIntArray_GetRef(vTmp, 0) = ((~k) & IOSIntArray_Get(vs, 0)) ^ (k & IOSIntArray_Get(vs, 4));
    *IOSIntArray_GetRef(vTmp, 1) = ((~k) & IOSIntArray_Get(vs, 1)) ^ (k & IOSIntArray_Get(vs, 5));
    *IOSIntArray_GetRef(vTmp, 2) = ((~k) & IOSIntArray_Get(vs, 2)) ^ (k & IOSIntArray_Get(vs, 6));
    *IOSIntArray_GetRef(vTmp, 3) = ((~k) & IOSIntArray_Get(vs, 3)) ^ (k & IOSIntArray_Get(vs, 7));
    *IOSShortArray_GetRef(nil_chk(c), 0 + i) = (jshort) ((IOSIntArray_Get(vTmp, 0) - IOSIntArray_Get(vTmp, 3)) & 3);
    *IOSShortArray_GetRef(c, 256 + i) = (jshort) ((IOSIntArray_Get(vTmp, 1) - IOSIntArray_Get(vTmp, 3)) & 3);
    *IOSShortArray_GetRef(c, 512 + i) = (jshort) ((IOSIntArray_Get(vTmp, 2) - IOSIntArray_Get(vTmp, 3)) & 3);
    *IOSShortArray_GetRef(c, 768 + i) = (jshort) ((-k + 2 * IOSIntArray_Get(vTmp, 3)) & 3);
  }
}

jshort OrgSpongycastlePqcCryptoNewhopeErrorCorrection_LDDecodeWithInt_withInt_withInt_withInt_(jint xi0, jint xi1, jint xi2, jint xi3) {
  OrgSpongycastlePqcCryptoNewhopeErrorCorrection_initialize();
  jint t;
  t = OrgSpongycastlePqcCryptoNewhopeErrorCorrection_gWithInt_(xi0);
  t += OrgSpongycastlePqcCryptoNewhopeErrorCorrection_gWithInt_(xi1);
  t += OrgSpongycastlePqcCryptoNewhopeErrorCorrection_gWithInt_(xi2);
  t += OrgSpongycastlePqcCryptoNewhopeErrorCorrection_gWithInt_(xi3);
  t -= 8 * OrgSpongycastlePqcCryptoNewhopeParams_Q;
  return (jshort) (JreURShift32(t, 31));
}

void OrgSpongycastlePqcCryptoNewhopeErrorCorrection_recWithByteArray_withShortArray_withShortArray_(IOSByteArray *key, IOSShortArray *v, IOSShortArray *c) {
  OrgSpongycastlePqcCryptoNewhopeErrorCorrection_initialize();
  OrgSpongycastleUtilArrays_fillWithByteArray_withByte_(key, (jbyte) 0);
  IOSIntArray *tmp = [IOSIntArray newArrayWithLength:4];
  for (jint i = 0; i < 256; ++i) {
    *IOSIntArray_GetRef(tmp, 0) = 16 * OrgSpongycastlePqcCryptoNewhopeParams_Q + 8 * (jint) IOSShortArray_Get(nil_chk(v), 0 + i) - OrgSpongycastlePqcCryptoNewhopeParams_Q * (2 * IOSShortArray_Get(nil_chk(c), 0 + i) + IOSShortArray_Get(c, 768 + i));
    *IOSIntArray_GetRef(tmp, 1) = 16 * OrgSpongycastlePqcCryptoNewhopeParams_Q + 8 * (jint) IOSShortArray_Get(v, 256 + i) - OrgSpongycastlePqcCryptoNewhopeParams_Q * (2 * IOSShortArray_Get(c, 256 + i) + IOSShortArray_Get(c, 768 + i));
    *IOSIntArray_GetRef(tmp, 2) = 16 * OrgSpongycastlePqcCryptoNewhopeParams_Q + 8 * (jint) IOSShortArray_Get(v, 512 + i) - OrgSpongycastlePqcCryptoNewhopeParams_Q * (2 * IOSShortArray_Get(c, 512 + i) + IOSShortArray_Get(c, 768 + i));
    *IOSIntArray_GetRef(tmp, 3) = 16 * OrgSpongycastlePqcCryptoNewhopeParams_Q + 8 * (jint) IOSShortArray_Get(v, 768 + i) - OrgSpongycastlePqcCryptoNewhopeParams_Q * (IOSShortArray_Get(c, 768 + i));
    *IOSByteArray_GetRef(nil_chk(key), JreURShift32(i, 3)) |= JreLShift32(OrgSpongycastlePqcCryptoNewhopeErrorCorrection_LDDecodeWithInt_withInt_withInt_withInt_(IOSIntArray_Get(tmp, 0), IOSIntArray_Get(tmp, 1), IOSIntArray_Get(tmp, 2), IOSIntArray_Get(tmp, 3)), (i & 7));
  }
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgSpongycastlePqcCryptoNewhopeErrorCorrection)
